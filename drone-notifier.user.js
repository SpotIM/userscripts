// ==UserScript==
// @name         Drone Notifier
// @namespace    https://droneio.spot.im/
// @version      0.3
// @description  notifiy on drone builds
// @author       You
// @match        https://droneio.spot.im/*
// @grant        none
// ==/UserScript==

(async function () {
  'use strict';
  const dataLSKey = '__SPOTIM_DEPLOY_NOTIFIER__';
  const settingsLSKey = '__SPOTIM_SETTINGS__';
  const settingsElId = '__spotim_settings__';

  const icons = {
    pending: 'data:image/png;base64,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',
    running: 'data:image/png;base64,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',
    success: 'data:image/png;base64,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',
    failure: 'data:image/png;base64,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',
  }

  let isFirstRun = false;
  let deploymentTargets = loadSettings();

  function loadData() {
    return JSON.parse(localStorage.getItem(dataLSKey) || '{}')
  }

  function saveData(data) {
    localStorage.setItem(dataLSKey, JSON.stringify(data));
  }

  function loadSettings() {
    return JSON.parse(localStorage.getItem(settingsLSKey)) || ['staging-comm.topics, production-comm.topics'];
  }

  function saveSettings(data) {
    localStorage.setItem(settingsLSKey, JSON.stringify(data));
  }

  function showNotification({ title, message, deployNumber, icon }) {
    var notification = new Notification(title, {
      icon: icon,
      body: message,
    });

    notification.onclick = function () {
      location.href = `https://droneio.spot.im/SpotIM/fed.modules/${deployNumber}`;
    };
  }

  async function fetchBuilds() {
    let prevDeploys = loadData();

    const builds = await fetch('https://droneio.spot.im/api/repos/SpotIM/fed.modules/builds').then(res => res.json());
    const deploys = builds
      .filter(build => build.event === 'deployment')
      .filter(build => deploymentTargets.indexOf(build.deploy_to) !== -1)

    deploys.forEach(deploy => {
      if (!prevDeploys[deploy.number] || prevDeploys[deploy.number].status !== deploy.status) {
        if (!isFirstRun) {
          showNotification({
            title: `Deploy ${deploy.number} (${deploy.deploy_to})`,
            message: `Status: ${deploy.status}`,
            deployNumber: deploy.number,
            icon: icons[deploy.status]
          })
        }
      }
      prevDeploys[deploy.number] = deploy;
    });

    saveData(prevDeploys);

    isFirstRun = false;
  }

  function addSettings() {
    const drawer = document.querySelector('[class^="drawer__inner"]');
    drawer.innerHTML += `
            <div id="${settingsElId}" style="
                padding: 20px;
                background: #f7f7f7;
                border-top: 1px solid #eee;
            "><div>Notify On Environments:</div><input placeholder="staging-comm.topics, staging-fed.prerender" style="
                margin-top: 11px;
                padding: 10px;
                width: calc(100% - 20px);
            "></div>
        `
    const input = document.querySelector(`#${settingsElId} input`);
    input.value = loadSettings().join(', ');
    input.addEventListener('keyup', () => {
      saveSettings(input.value.split(',').map(item => item.trim()));
      deploymentTargets = loadSettings();
    });
  }

  Notification.requestPermission();
  setInterval(fetchBuilds, 1000)
  addSettings();
})();
